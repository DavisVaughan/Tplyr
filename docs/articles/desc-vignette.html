<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Descriptive Statistic Layers • Tplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Descriptive Statistic Layers">
<meta property="og:description" content="Tplyr">
<meta property="og:image" content="/reference/figures/Atorus_Stickers_vF_Tplyr.png">
<meta property="og:image:alt" content="Tplyr Hex Sticker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@AtorusR">
<meta name="twitter:site" content="@AtorusR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Tplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Tplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Layer Vignettes</li>
    <li>
      <a href="../articles/desc-vignette.html">Descriptive Statistic Layers</a>
    </li>
    <li>
      <a href="../articles/count_shift.html">Count and Shift Tables</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Helpers</li>
    <li>
      <a href="../articles/riskdiff.html">Risk Difference</a>
    </li>
    <li>
      <a href="../articles/sort.html">Sorting a Tplyr Table</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Release Vignettes</li>
    <li>
      <a href="../articles/alpha-release.html">Tplyr (Alpha Release)</a>
    </li>
    <li>
      <a href="../articles/beta-release.html">Tplyr (Beta Release)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atorus-research/Tplyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Descriptive Statistic Layers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atorus-research/Tplyr/blob/master/vignettes/desc-vignette.Rmd"><code>vignettes/desc-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>desc-vignette.Rmd</code></div>

    </div>

    
    
<p>Descriptive statistics in ‘Tplyr’ are created using <code>group_desc</code> function when creating a layer. While <code>group_desc</code> allows you to set your target, by variables, and filter criteria, a great deal of the control of the layer comes from <code>set_format_strings</code> where the actual summaries are declared.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AGE</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"Age (years)"</span>, <span class="kw">where</span><span class="kw">=</span> <span class="no">SAFFL</span><span class="kw">==</span><span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">"n"</span>        <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx"</span>, <span class="no">n</span>),
        <span class="st">"Mean (SD)"</span><span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx.x (xx.xx)"</span>, <span class="no">mean</span>, <span class="no">sd</span>),
        <span class="st">"Median"</span>   <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx.x"</span>, <span class="no">median</span>),
        <span class="st">"Q1, Q3"</span>   <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx, xx"</span>, <span class="no">q1</span>, <span class="no">q3</span>),
        <span class="st">"Min, Max"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx, xx"</span>, <span class="no">min</span>, <span class="no">max</span>),
        <span class="st">"Missing"</span>  <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx"</span>, <span class="no">missing</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">n</td>
<td align="left">86</td>
<td align="left">84</td>
<td align="left">84</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="left">75.2 ( 8.59)</td>
<td align="left">74.4 ( 7.89)</td>
<td align="left">75.7 ( 8.29)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Median</td>
<td align="left">76.0</td>
<td align="left">76.0</td>
<td align="left">77.5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Q1, Q3</td>
<td align="left">69, 82</td>
<td align="left">71, 80</td>
<td align="left">71, 82</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Min, Max</td>
<td align="left">52, 89</td>
<td align="left">56, 88</td>
<td align="left">51, 88</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Missing</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>The settings above are actually the ‘Tplyr’ default, so if these are the results you desire, then there’s no need to use <code>set_format_strings</code> at all - and just the <code>group_desc</code> call can be used. But let’s walk through this call to <code>set_format_strings</code> to understand in detail what’s going on:</p>
<ol style="list-style-type: decimal">
<li>The quotes strings on the left of the ‘=’, to name each parameter, become the row label in the output. This allows you to define in <code>set_format_strings</code> some custom text to explain the summary that is presented on the associated row. This text is fully in your control.</li>
<li>On the right side of each equals is a call to <code>f_str</code>. As explained in the ‘Getting Started’ vignette, this is an object that captures a lot of metadata to understand how the strings should be presented.</li>
<li>Within the <code>f_str</code> call, you see x’s in quotes. This defines how you’d like the numbers formatted from the resulting summaries. The number of x’s you use on the left side of a decimal control the space allotted for an integer, and the right side controls the decimal precision. Decimals are rounded prior to string formatting - so no need to worry about that. Note that this forcefully sets the decimal and integer precision - ‘Tplyr’ can automatically determine this for you as well, but more on that later.</li>
<li>After the x’s there are unquoted variable names. This is where you specify the actual summaries that will be performed. Notice that some <code>f_str</code> calls have two summaries specified. This allows you to put two summaries in the same string and present them on the same line.</li>
</ol>
<p>But where do these summary names come from? And which ones does ‘Tplyr’ have?</p>
<div id="built-in-summaries" class="section level2">
<h2 class="hasAnchor">
<a href="#built-in-summaries" class="anchor"></a>Built-in Summaries</h2>
<p>We’ve built a number of default summaries into ‘Tplyr’, which allows you to perform these summaries without having to specify the functions to calculate them yourself. The summaries built in to ‘Tplyr’ are listed below. In the second column are the names that you would use within an <code>f_str</code> call to use them. In the third column, we have the syntax used to make the function call.</p>
<table class="table">
<thead><tr class="header">
<th align="center">Statistic</th>
<th align="center">Variable Names</th>
<th align="left">Function Call</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">N</td>
<td align="center">n</td>
<td align="left">n()</td>
</tr>
<tr class="even">
<td align="center">Mean</td>
<td align="center">mean</td>
<td align="left">mean(.var, na.rm=TRUE)</td>
</tr>
<tr class="odd">
<td align="center">Standard Deviation</td>
<td align="center">sd</td>
<td align="left">sd(.var, na.rm=TRUE)</td>
</tr>
<tr class="even">
<td align="center">Median</td>
<td align="center">median</td>
<td align="left">median(.var, na.rm=TRUE)</td>
</tr>
<tr class="odd">
<td align="center">Variance</td>
<td align="center">variance</td>
<td align="left">var(.var, na.rm=TRUE)</td>
</tr>
<tr class="even">
<td align="center">Minimum</td>
<td align="center">min</td>
<td align="left">min(.var, na.rm=TRUE)</td>
</tr>
<tr class="odd">
<td align="center">Maximum</td>
<td align="center">max</td>
<td align="left">max(.var, na.rm=TRUE)</td>
</tr>
<tr class="even">
<td align="center">Interquartile Range</td>
<td align="center">iqr</td>
<td align="left">IQR(.var, na.rm=TRUE, type=getOption(‘tplyr.quantile_type’)</td>
</tr>
<tr class="odd">
<td align="center">Q1</td>
<td align="center">q1</td>
<td align="left">quantile(.var, na.rm=TRUE, type=getOption(‘tplyr.quantile_type’))[[2]]</td>
</tr>
<tr class="even">
<td align="center">Q3</td>
<td align="center">q3</td>
<td align="left">quantile(.var, na.rm=TRUE, type=getOption(‘tplyr.quantile_type’))[[4]]</td>
</tr>
<tr class="odd">
<td align="center">Missing</td>
<td align="center">missing</td>
<td align="left">sum(is.na(.var))</td>
</tr>
</tbody>
</table>
<div id="notes-about-built-ins" class="section level3">
<h3 class="hasAnchor">
<a href="#notes-about-built-ins" class="anchor"></a>Notes About Built-in’s</h3>
<p>Note that the only non-default option being used in any of the function calls above is <code>na.rm=TRUE</code>. For most of the functions, this is likely fine - but with IQR, Q1, and Q3 note that there are several different quantile algorithms available in R. The default we chose to use is the R default of Type 7:</p>
<p><span class="math display">\[
m = 1-p. p[k] = (k - 1) / (n - 1). \textrm{In this case, } p[k] = mode[F(x[k])]. \textrm{This is used by S.}
\]</span> That said, we still want to offer some flexibility here, so you can change the quantile algorithm by switching the <code>tplyr.quantile_type</code> option. If you’re intending to match the SAS definition, you can use Type 3. For more information, see the <code>quantile</code> documentation.</p>
<p>The example below demonstrates using the default quantile algorithm in R</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">CUMDOSE</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">"Q1, Q3"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xxxxx, xxxxx'</span>, <span class="no">q1</span>, <span class="no">q3</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">"ord"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">0, 0</td>
<td align="left">2646, 13959</td>
<td align="left">1984, 9801</td>
</tr></tbody>
</table>
<p>This next example demonstrates using quantile algorithm Type 3, which matches the SAS definition of:</p>
<p><span class="math display">\[
\textrm{Nearest even order statistic. γ = 0 if g = 0 and  j is even, and 1 otherwise.}
\]</span></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">tplyr.quantile_type</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">CUMDOSE</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">"Q1, Q3"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xxxxx, xxxxx'</span>, <span class="no">q1</span>, <span class="no">q3</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">"ord"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">0, 0</td>
<td align="left">2565, 13959</td>
<td align="left">1944, 9774</td>
</tr></tbody>
</table>
<p>It’s up to you to determine which algorithm you should use - but we found it necessary to provide you with the flexibility to change this within the default summaries.</p>
<p>But what if Tplyr doesn’t offer you the summaries that you need?</p>
</div>
</div>
<div id="custom-summaries" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-summaries" class="anchor"></a>Custom Summaries</h2>
<p>We understand that our defaults may not cover every descriptive statistic that you’d like to see. That’s why we’ve opened to door to creating custom summaries. Custom summaries allow you to provide any function you’d like into a desc layer. You can focus on the derivation and how to calculate the number you want to see. Tplyr can consume this function, and use all the existing tools within Tplyr to produce the string formatted result alongside any of the default summaries we provide as well.</p>
<p>Custom summaries may be provided in two ways:</p>
<ul>
<li>Through the <code>tplyr.custom_summaries</code> option set at your session level</li>
<li>Through the function <code>set_custom_summaries</code> at the layer level</li>
</ul>
<p>As with any other setting in Tplyr, the layer setting will always take precedence over any other setting.</p>
<p>Let’s look at an example.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="fu">vars</span>(<span class="no">AGE</span>, <span class="no">HEIGHTBL</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">"Sepal Length"</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_custom_summaries.html">set_custom_summaries</a></span>(
        <span class="kw">geometric_mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">.var</span>[<span class="no">.var</span> <span class="kw">&gt;</span> <span class="fl">0</span>]), <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>) / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.var</span>))
      ) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Geometric Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx.xx (xx.xxx)'</span>, <span class="no">geometric_mean</span>, <span class="no">sd</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">"ord"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="left">var2_Placebo</th>
<th align="left">var2_Xanomeline High Dose</th>
<th align="left">var2_Xanomeline Low Dose</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Sepal Length</td>
<td align="left">Geometric Mean (SD)</td>
<td align="left">74.70 ( 8.590)</td>
<td align="left">73.94 ( 7.886)</td>
<td align="left">75.18 ( 8.286)</td>
<td align="left">162.17 (11.522)</td>
<td align="left">165.51 (10.131)</td>
<td align="left">163.11 (10.419)</td>
</tr></tbody>
</table>
<p>Here, a few important things are demonstrated:</p>
<ul>
<li>This is a multi-variable descriptive statistics layer. Both <code>AGE</code> and <code>HEIGHTBL</code> are being summarized in the same layer. AGE results go to the <code>var1_</code> variables and <code>HEIGHTBL</code> results go to the <code>var2_</code> variables.</li>
<li>The parameter names in <code>set_custom_summaries</code>, or names on the left side of the equals, flow into <code>set_format_strings</code> in the <code>f_str</code> calls. Just like the default summaries, <code>geometric_mean</code> becomes the name that you refer to in order to use the geometric mean derivation in a summary.</li>
<li>In geometric mean, the target variable that you’re summarizing is referred to as <code>.var</code>. This may not seem intuitive. The reason we have to use <code>.var</code> is so that, like in this example, the custom function can be applied to each of the separate target variables.</li>
</ul>
<p>Another note about custom summaries is that you’re able to overwrite the default summaries built into Tplyr as well. Don’t like the default summary functions that we provide? Use the <code>tplyr.custom_summaries</code> option to overwrite them in your session, and add any new ones that you would like to include.</p>
<p>For example, here we use the Tplyr default mean.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AGE</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">"Mean"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx.xx'</span>, <span class="no">mean</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Mean</td>
<td align="left">75.21</td>
<td align="left">74.38</td>
<td align="left">75.67</td>
<td align="right">1</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p>But now, let’s overwrite <code>mean</code> using a custom summary. Let’s use a trimmed mean instead, taking 20% of observations off of both ends.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">tplyr.custom_summaries</span> <span class="kw">=</span>
          <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">quos</a></span>(
            <span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">.var</span>, <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">trim</span><span class="kw">=</span><span class="fl">0.4</span>)
          )
        )

<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AGE</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">"Mean"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx.xx'</span>, <span class="no">mean</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Mean</td>
<td align="left">76.28</td>
<td align="left">75.94</td>
<td align="left">77.44</td>
<td align="right">1</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p>Note that the table code used to produce the output is the same. Now ‘Tplyr’ used the custom summary function for <code>mean</code> as specified in the <code>tplyr.custom_summaries</code> option. Also note the use of <code><a href="https://rlang.r-lib.org/reference/nse-defuse.html">rlang::quos</a></code>. We’ve done our best to mask this from the user everywhere possible and make the interfaces clean and intuitive, but a great deal of ‘Tplyr’ is built using ‘rlang’ and non-standard evaluation. Within this option is one of the very few instances where a user needs to concern themselves with the use of quosures. If you’d like to learn more about non-standard evaluation and quosures, we recommend <a href="https://adv-r.hadley.nz/metaprogramming.html">Section IV</a> in Advanced R.</p>
</div>
<div id="formatting" class="section level2">
<h2 class="hasAnchor">
<a href="#formatting" class="anchor"></a>Formatting</h2>
<p>A lot of the nuance to formatting descriptive statistics layers has already been covered above, but there are a couple more tricks to getting the most out of ‘Tplyr’. One of these tricks is filling empty values.</p>
<p>By default, if there is no available value for a summary in a particular observation, the result being presented will be blanked out.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">adlb_2</span> <span class="kw">&lt;-</span> <span class="no">adlb</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">TRTA</span> <span class="kw">!=</span> <span class="st">"Placebo"</span>)

<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb_2</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_data.html">set_pop_data</a></span>(<span class="no">adsl</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_treat_var.html">set_pop_treat_var</a></span>(<span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span><span class="kw">=</span><span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xxx (xxx)'</span>, <span class="no">mean</span>, <span class="no">sd</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">"ord"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">39 ( )</td>
<td align="left">41 ( 4)</td>
</tr>
<tr class="even">
<td align="left">ALP</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">70 ( 29)</td>
</tr>
<tr class="odd">
<td align="left">ALT</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">26 ( 8)</td>
<td align="left">15 ( 8)</td>
</tr>
<tr class="even">
<td align="left">AST</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">20 ( 0)</td>
<td align="left">20 ( 2)</td>
</tr>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">11 ( 4)</td>
<td align="left">9 ( 5)</td>
</tr>
<tr class="even">
<td align="left">BUN</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">7 ( )</td>
<td align="left">9 ( 2)</td>
</tr>
</tbody>
</table>
<p>Note how the entire example above has the <code>var1_Placebo</code> records missing. ‘Tplyr’ gives you control over how you fill this space. Let’s say that we wanted instead to make that space say “Missing”. You can control this with the f_str object using the <code>empty</code> parameter</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">adlb_2</span> <span class="kw">&lt;-</span> <span class="no">adlb</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">TRTA</span> <span class="kw">!=</span> <span class="st">"Placebo"</span>)

<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb_2</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_data.html">set_pop_data</a></span>(<span class="no">adsl</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_treat_var.html">set_pop_treat_var</a></span>(<span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span><span class="kw">=</span><span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xxx.xx (xxx.xxx)'</span>, <span class="no">mean</span>, <span class="no">sd</span>, <span class="kw">empty</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">.overall</span><span class="kw">=</span><span class="st">"MISSING"</span>)))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">"ord"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Mean (SD)</td>
<td align="left">MISSING</td>
<td align="left">39.00 (MISSING)</td>
<td align="left">41.00 ( 4.243)</td>
</tr>
<tr class="even">
<td align="left">ALP</td>
<td align="left">Mean (SD)</td>
<td align="left">MISSING</td>
<td align="left">MISSING</td>
<td align="left">70.00 ( 29.193)</td>
</tr>
<tr class="odd">
<td align="left">ALT</td>
<td align="left">Mean (SD)</td>
<td align="left">MISSING</td>
<td align="left">26.50 ( 7.778)</td>
<td align="left">15.00 ( 8.408)</td>
</tr>
<tr class="even">
<td align="left">AST</td>
<td align="left">Mean (SD)</td>
<td align="left">MISSING</td>
<td align="left">20.00 ( 0.000)</td>
<td align="left">20.00 ( 2.309)</td>
</tr>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">MISSING</td>
<td align="left">11.11 ( 4.426)</td>
<td align="left">9.40 ( 4.709)</td>
</tr>
<tr class="even">
<td align="left">BUN</td>
<td align="left">Mean (SD)</td>
<td align="left">MISSING</td>
<td align="left">6.78 (MISSING)</td>
<td align="left">8.75 ( 1.767)</td>
</tr>
</tbody>
</table>
<p>Notice that the <code>empty</code> parameter here is a named character vector. The name used is ‘.overall’. When you name this vector, ‘Tplyr’ know to fill the entire space when both elements are empty. But you may not <em>want</em> to fill the entire space. In the example above, both mean and standard deviation. are missing for Placebo, but other results are just missing standard deviation, which can happen if there’s only one record in the group. Here, if you don’t name the <code>empty</code> parameter, ‘Tplyr’ instead fits your specified ‘empty’ string into the formatted text, and aligns the data properly (assuming your string fits).</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">adlb_2</span> <span class="kw">&lt;-</span> <span class="no">adlb</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">TRTA</span> <span class="kw">!=</span> <span class="st">"Placebo"</span>)

<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb_2</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_data.html">set_pop_data</a></span>(<span class="no">adsl</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_treat_var.html">set_pop_treat_var</a></span>(<span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span><span class="kw">=</span><span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xxx.xx (xxx.xxx)'</span>, <span class="no">mean</span>, <span class="no">sd</span>, <span class="kw">empty</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NA"</span>)))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">"ord"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Mean (SD)</td>
<td align="left">NA ( NA)</td>
<td align="left">39.00 ( NA)</td>
<td align="left">41.00 ( 4.243)</td>
</tr>
<tr class="even">
<td align="left">ALP</td>
<td align="left">Mean (SD)</td>
<td align="left">NA ( NA)</td>
<td align="left">NA ( NA)</td>
<td align="left">70.00 ( 29.193)</td>
</tr>
<tr class="odd">
<td align="left">ALT</td>
<td align="left">Mean (SD)</td>
<td align="left">NA ( NA)</td>
<td align="left">26.50 ( 7.778)</td>
<td align="left">15.00 ( 8.408)</td>
</tr>
<tr class="even">
<td align="left">AST</td>
<td align="left">Mean (SD)</td>
<td align="left">NA ( NA)</td>
<td align="left">20.00 ( 0.000)</td>
<td align="left">20.00 ( 2.309)</td>
</tr>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">NA ( NA)</td>
<td align="left">11.11 ( 4.426)</td>
<td align="left">9.40 ( 4.709)</td>
</tr>
<tr class="even">
<td align="left">BUN</td>
<td align="left">Mean (SD)</td>
<td align="left">NA ( NA)</td>
<td align="left">6.78 ( NA)</td>
<td align="left">8.75 ( 1.767)</td>
</tr>
</tbody>
</table>
<div id="auto-precision" class="section level3">
<h3 class="hasAnchor">
<a href="#auto-precision" class="anchor"></a>Auto Precision</h3>
<p>You may have noticed that the approach to formatting covered so far leaves a lot to be desired. Consider analyzing lab results, where you may want precision to vary based on the collected precision of the tests. Furthermore, depending on the summary being presented, you may wish to increase the precision further. For example, you may want the mean to be at collected precision +1 decimal place, for standard deviation +2.</p>
<p>‘Tplyr’ has this covered using auto-precision. Auto-precision allows you to format your numeric summaries based on the precision of the data collected. This has all been built into the format strings, because a natural place to specify your desired format is where you specify how you want your data presented. If you wish to use auto-precision, use <code>a</code> instead of <code>x</code> when creating your summaries. Note that only one <code>a</code> is needed. To use increased precision, use <code>a+n</code> where <code>n</code> is the number of additional spaces you wish to add.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">
<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'a.a+1 (a.a+2)'</span>, <span class="no">mean</span>, <span class="no">sd</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">20</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Mean (SD)</td>
<td align="left">40.0 ( 4.32)</td>
<td align="left">39.0 ( )</td>
<td align="left">41.0 ( 4.24)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALP</td>
<td align="left">Mean (SD)</td>
<td align="left">85.5 ( 20.07)</td>
<td align="left"></td>
<td align="left">70.0 ( 29.19)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ALT</td>
<td align="left">Mean (SD)</td>
<td align="left">18.5 (12.19)</td>
<td align="left">26.5 ( 7.78)</td>
<td align="left">15.0 ( 8.41)</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">AST</td>
<td align="left">Mean (SD)</td>
<td align="left">20.0 ( 4.73)</td>
<td align="left">20.0 ( 0.00)</td>
<td align="left">20.0 ( 2.31)</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">6.840 ( 0.9873)</td>
<td align="left">11.115 ( 4.4262)</td>
<td align="left">9.405 ( 4.7090)</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">BUN</td>
<td align="left">Mean (SD)</td>
<td align="left">6.0690 (0.94333)</td>
<td align="left">6.7830 ( )</td>
<td align="left">8.7465 (1.76706)</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CA</td>
<td align="left">Mean (SD)</td>
<td align="left">2.262133 (0.0718184)</td>
<td align="left">2.270450 (0.0499000)</td>
<td align="left">2.345300 (0.0772376)</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CHOL</td>
<td align="left">Mean (SD)</td>
<td align="left">5.275440 (1.0265475)</td>
<td align="left">5.546970 (1.0838292)</td>
<td align="left">6.077100 (1.1714323)</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CK</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">78.5 ( 21.41)</td>
<td align="left">101.0 ( 6.08)</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CL</td>
<td align="left">Mean (SD)</td>
<td align="left">105.0 ( 1.37)</td>
<td align="left">105.0 ( 2.59)</td>
<td align="left">104.0 ( 2.71)</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CREAT</td>
<td align="left">Mean (SD)</td>
<td align="left">119.340 ( 21.0434)</td>
<td align="left">110.500 ( 9.2715)</td>
<td align="left">106.080 ( 16.1396)</td>
<td align="right">1</td>
<td align="right">11</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">GGT</td>
<td align="left">Mean (SD)</td>
<td align="left">10.0 ( )</td>
<td align="left">16.0 ( 4.51)</td>
<td align="left">14.0 ( 4.98)</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">GLUC</td>
<td align="left">Mean (SD)</td>
<td align="left">4.801615 (0.7516773)</td>
<td align="left">4.940390 ( )</td>
<td align="left">4.385290 (1.2486666)</td>
<td align="right">1</td>
<td align="right">13</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">K</td>
<td align="left">Mean (SD)</td>
<td align="left">4.23 (0.355)</td>
<td align="left">4.30 (0.665)</td>
<td align="left">4.30 (0.404)</td>
<td align="right">1</td>
<td align="right">14</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">PHOS</td>
<td align="left">Mean (SD)</td>
<td align="left">1.065570 (0.2739897)</td>
<td align="left">1.227020 ( )</td>
<td align="left">1.114005 (0.1003937)</td>
<td align="right">1</td>
<td align="right">15</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">PROT</td>
<td align="left">Mean (SD)</td>
<td align="left">72.0 ( 3.21)</td>
<td align="left">70.5 ( 4.92)</td>
<td align="left">72.0 ( 3.77)</td>
<td align="right">1</td>
<td align="right">16</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SODIUM</td>
<td align="left">Mean (SD)</td>
<td align="left">141.5 ( 0.71)</td>
<td align="left">141.0 ( 0.00)</td>
<td align="left"></td>
<td align="right">1</td>
<td align="right">17</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">285.5040 ( 65.19585)</td>
<td align="left">270.6340 ( 29.44110)</td>
<td align="left">327.1400 (120.76051)</td>
<td align="right">1</td>
<td align="right">18</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>As you can see, the decimal precision is now varying depending on the test being performed. Notice that both the integer and the decimal side of each number fluctuate as well. Tpylr collects both the integer and decimal precision, and you can specify both separately. For example, you could use <code>x</code>’s to specify a default number of spaces for your integers that are used consistently across by variables, but vary the decimal precision based on collected data. You can also increment the number of spaces for both integer and decimal separately.</p>
<p>But - this is kind of ugly, isn’t it? Do we really need all 6 decimal places collected for CA? For this reason, you’re able to set a cap on the precision that’s displayed:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'a.a+1 (a.a+2)'</span>, <span class="no">mean</span>, <span class="no">sd</span>),
        <span class="kw">cap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">int</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">dec</span><span class="kw">=</span><span class="fl">2</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">20</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Mean (SD)</td>
<td align="left">40.0 ( 4.32)</td>
<td align="left">39.0 ( )</td>
<td align="left">41.0 ( 4.24)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALP</td>
<td align="left">Mean (SD)</td>
<td align="left">85.5 ( 20.07)</td>
<td align="left"></td>
<td align="left">70.0 ( 29.19)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ALT</td>
<td align="left">Mean (SD)</td>
<td align="left">18.5 (12.19)</td>
<td align="left">26.5 ( 7.78)</td>
<td align="left">15.0 ( 8.41)</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">AST</td>
<td align="left">Mean (SD)</td>
<td align="left">20.0 ( 4.73)</td>
<td align="left">20.0 ( 0.00)</td>
<td align="left">20.0 ( 2.31)</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">6.840 ( 0.9873)</td>
<td align="left">11.115 ( 4.4262)</td>
<td align="left">9.405 ( 4.7090)</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">BUN</td>
<td align="left">Mean (SD)</td>
<td align="left">6.069 (0.9433)</td>
<td align="left">6.783 ( )</td>
<td align="left">8.746 (1.7671)</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CA</td>
<td align="left">Mean (SD)</td>
<td align="left">2.262 (0.0718)</td>
<td align="left">2.270 (0.0499)</td>
<td align="left">2.345 (0.0772)</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CHOL</td>
<td align="left">Mean (SD)</td>
<td align="left">5.275 (1.0265)</td>
<td align="left">5.547 (1.0838)</td>
<td align="left">6.077 (1.1714)</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CK</td>
<td align="left">Mean (SD)</td>
<td align="left"></td>
<td align="left">78.5 ( 21.41)</td>
<td align="left">101.0 ( 6.08)</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CL</td>
<td align="left">Mean (SD)</td>
<td align="left">105.0 ( 1.37)</td>
<td align="left">105.0 ( 2.59)</td>
<td align="left">104.0 ( 2.71)</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CREAT</td>
<td align="left">Mean (SD)</td>
<td align="left">119.340 ( 21.0434)</td>
<td align="left">110.500 ( 9.2715)</td>
<td align="left">106.080 ( 16.1396)</td>
<td align="right">1</td>
<td align="right">11</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">GGT</td>
<td align="left">Mean (SD)</td>
<td align="left">10.0 ( )</td>
<td align="left">16.0 ( 4.51)</td>
<td align="left">14.0 ( 4.98)</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">GLUC</td>
<td align="left">Mean (SD)</td>
<td align="left">4.802 (0.7517)</td>
<td align="left">4.940 ( )</td>
<td align="left">4.385 (1.2487)</td>
<td align="right">1</td>
<td align="right">13</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">K</td>
<td align="left">Mean (SD)</td>
<td align="left">4.23 (0.355)</td>
<td align="left">4.30 (0.665)</td>
<td align="left">4.30 (0.404)</td>
<td align="right">1</td>
<td align="right">14</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">PHOS</td>
<td align="left">Mean (SD)</td>
<td align="left">1.066 (0.2740)</td>
<td align="left">1.227 ( )</td>
<td align="left">1.114 (0.1004)</td>
<td align="right">1</td>
<td align="right">15</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">PROT</td>
<td align="left">Mean (SD)</td>
<td align="left">72.0 ( 3.21)</td>
<td align="left">70.5 ( 4.92)</td>
<td align="left">72.0 ( 3.77)</td>
<td align="right">1</td>
<td align="right">16</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SODIUM</td>
<td align="left">Mean (SD)</td>
<td align="left">141.5 ( 0.71)</td>
<td align="left">141.0 ( 0.00)</td>
<td align="left"></td>
<td align="right">1</td>
<td align="right">17</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">285.504 ( 65.1958)</td>
<td align="left">270.634 ( 29.4411)</td>
<td align="left">327.140 (120.7605)</td>
<td align="right">1</td>
<td align="right">18</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Now that looks better. The <code>cap</code> argument is part of <code>set_format_strings</code>. You need to specify the integer and decimal caps separately. Note that integer precision might not behave like you expect - it doesn’t make sense to truncate an integer if it’s value is too high, so if the integer exceeds the allotted space, then the length of the string will increase and the full value will be displayed. But values that are short enough will only pad to the capped number of spaces. We plan to implement a warning in future releases if integers exceed the set display space allocation.</p>
<p>This was a basic situation, but if you’re paying close attention, you may have some questions. What if you have more by variables, like by visit AND test. Do we then calculate precision by visit and test? What if collected precision is different per visit and we don’t want that? What about multiple summary variable? How do we determine precision then? We have modifier functions for this:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="fu">vars</span>(<span class="no">AVAL</span>, <span class="no">CHG</span>, <span class="no">BASE</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'a.a+1 (a.a+2)'</span>, <span class="no">mean</span>, <span class="no">sd</span>, <span class="kw">empty</span><span class="kw">=</span><span class="st">"NA"</span>),
        <span class="kw">cap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">int</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">dec</span><span class="kw">=</span><span class="fl">2</span>)
      ) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/precision_on.html">set_precision_on</a></span>(<span class="no">AVAL</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/precision_by.html">set_precision_by</a></span>(<span class="no">PARAMCD</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="left">var2_Placebo</th>
<th align="left">var2_Xanomeline High Dose</th>
<th align="left">var2_Xanomeline Low Dose</th>
<th align="left">var3_Placebo</th>
<th align="left">var3_Xanomeline High Dose</th>
<th align="left">var3_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Mean (SD)</td>
<td align="left">40.0 ( 4.32)</td>
<td align="left">39.0 ( NA)</td>
<td align="left">41.0 ( 4.24)</td>
<td align="left">-2.0 ( 4.39)</td>
<td align="left">1.0 ( NA)</td>
<td align="left">0.0 ( 2.83)</td>
<td align="left">42.0 ( 2.19)</td>
<td align="left">38.0 ( NA)</td>
<td align="left">41.0 ( 1.41)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALP</td>
<td align="left">Mean (SD)</td>
<td align="left">85.5 ( 20.07)</td>
<td align="left">NA ( NA)</td>
<td align="left">70.0 ( 29.19)</td>
<td align="left">0.5 ( 6.45)</td>
<td align="left">NA ( NA)</td>
<td align="left">-6.0 ( 10.25)</td>
<td align="left">87.5 ( 24.92)</td>
<td align="left">NA ( NA)</td>
<td align="left">71.3 ( 36.04)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ALT</td>
<td align="left">Mean (SD)</td>
<td align="left">18.5 (12.19)</td>
<td align="left">26.5 ( 7.78)</td>
<td align="left">15.0 ( 8.41)</td>
<td align="left">0.0 ( 7.80)</td>
<td align="left">4.5 ( 2.12)</td>
<td align="left">-4.0 ( 4.86)</td>
<td align="left">21.0 ( 6.18)</td>
<td align="left">22.0 ( 5.66)</td>
<td align="left">20.0 ( 7.79)</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">AST</td>
<td align="left">Mean (SD)</td>
<td align="left">20.0 ( 4.73)</td>
<td align="left">20.0 ( 0.00)</td>
<td align="left">20.0 ( 2.31)</td>
<td align="left">-2.5 ( 3.54)</td>
<td align="left">0.0 ( 4.24)</td>
<td align="left">-2.0 ( 1.41)</td>
<td align="left">20.0 ( 7.00)</td>
<td align="left">20.0 ( 4.24)</td>
<td align="left">23.0 ( 1.53)</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">6.840 ( 0.9873)</td>
<td align="left">11.115 ( 4.4262)</td>
<td align="left">9.405 ( 4.7090)</td>
<td align="left">-1.710 ( 1.9745)</td>
<td align="left">0.000 ( 9.0968)</td>
<td align="left">0.000 ( 3.5596)</td>
<td align="left">8.550 ( 0.9873)</td>
<td align="left">8.550 (12.5659)</td>
<td align="left">6.840 ( 2.8614)</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">BUN</td>
<td align="left">Mean (SD)</td>
<td align="left">6.069 (0.9433)</td>
<td align="left">6.783 ( NA)</td>
<td align="left">8.746 (1.7671)</td>
<td align="left">0.536 (1.0276)</td>
<td align="left">2.499 ( NA)</td>
<td align="left">1.071 ( NA)</td>
<td align="left">5.355 (1.0868)</td>
<td align="left">4.284 ( NA)</td>
<td align="left">8.211 (2.5244)</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Three variables are being summarized here - AVAL, CHG, and BASE. So which should be used for precision? <code>set_precision_on</code> allows you to specify this, where the <code>precision_on</code> variable must be one of the variables within <code>target_var</code>. Similarly, <code>set_precision_by</code> changes the <code>by</code> variables used to determine collected precision. If no <code>precision_on</code> variable is specified, the first variable in <code>target_var</code> is used. If not <code>precision_by</code> variables are specified, then the default <code>by</code> variables are used.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eli Miller, Mike Stackhouse, Ashley Tarasiewicz, Nathan Kosiba.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
