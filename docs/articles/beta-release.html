<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tplyr (Beta Release) • Tplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tplyr (Beta Release)">
<meta property="og:description" content="Tplyr">
<meta property="og:image" content="/reference/figures/Atorus_Stickers_vF_Tplyr.png">
<meta property="og:image:alt" content="Tplyr Hex Sticker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@AtorusR">
<meta name="twitter:site" content="@AtorusR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Tplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Tplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Layer Vignettes</li>
    <li>
      <a href="../articles/desc-vignette.html">Descriptive Statistic Layers</a>
    </li>
    <li>
      <a href="../articles/count_shift.html">Count and Shift Tables</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Helpers</li>
    <li>
      <a href="../articles/riskdiff.html">Risk Difference</a>
    </li>
    <li>
      <a href="../articles/sort.html">Sorting a Tplyr Table</a>
    </li>
    <li>
      <a href="../articles/options-vignette.html">Tplyr Options</a>
    </li>
    <li>
      <a href="../articles/styled-table.html">Producing a Styled Table</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Release Vignettes</li>
    <li>
      <a href="../articles/alpha-release.html">Tplyr (Alpha Release)</a>
    </li>
    <li>
      <a href="../articles/beta-release.html">Tplyr (Beta Release)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atorus-research/Tplyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tplyr (Beta Release)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atorus-research/Tplyr/blob/master/vignettes/beta-release.Rmd"><code>vignettes/beta-release.Rmd</code></a></small>
      <div class="hidden name"><code>beta-release.Rmd</code></div>

    </div>

    
    
<div id="the-beta-release" class="section level1">
<h1 class="hasAnchor">
<a href="#the-beta-release" class="anchor"></a>The Beta Release</h1>
<p>Three weeks ago, we released the Alpha release of Tplyr. Since then, we’ve been hard at work introducing some fresh features to make Tplyr more flexible, more effective, and more useful as a tool for you and your organization. Some of these additions are less alluring from the surface, but introduce critical functionality needed for Tplyr to accomplish the goals we’ve laid out.</p>
<p>The enhancements that we’re going to cover in this document are as follows: - General updates: - Calculate your header N counts based on the population dataset or the target dataset. The alpha release had an option to set the population data but this wasn’t actually used anywhere in the internals. - Use these header N counts as token replacements when using the <code>add_column_headers</code> function. - Order variables are now added to the built dataset to allow you to sort the output dataset as you wish with numeric variables. - Count layer updates: - Optionally use the population data N counts as denominators for percent calculation. - For multi-level count summaries, nest the row label columns together to present both row labels in a single column - You can now present both distinct and non-distinct counts instead of one or the other - Sorting options allow you to order results from the target variable values or from derived counts within a specified column - Risk difference calculations can now be added as additional columns, with flexible options for presentation - Descriptive statistics layer updates: - The custom summary functionality has been updated to apply to multi-variable summaries, which results in an interface change - Automatic decimal precision has been added to allow you to base the presentation on the precision of the data as collected</p>
<p>Let’s dig into each of these updates one by one.</p>
<div id="count-layer-updates" class="section level2">
<h2 class="hasAnchor">
<a href="#count-layer-updates" class="anchor"></a>Count layer updates</h2>
<p>The general updates are best presented within the context of a count layer. An important feature that was missing from the alpha release was the capability to control the denominator being used in a summary. For example, if you’re summarizing adverse events, not all subjects may have been included adverse events dataset. A subject only exists in the adverse events dataset if they had an adverse event. Therefore, if you’re counting the total subjects for your denominator, the denominator will be missing subjects. This is exactly why we included bindings for a separate population dataset in the first place, and now the population data are properly utilized.</p>
<p>Consider the following:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r">
<span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>, <span class="kw">where</span><span class="kw">=</span> <span class="no">SAFFL</span> <span class="kw">==</span> <span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_data.html">set_pop_data</a></span>(<span class="no">adsl</span>) <span class="kw">%&gt;%</span>  <span class="co"># Specify the population dataset</span>
  <span class="fu"><a href="../reference/pop_treat_var.html">set_pop_treat_var</a></span>(<span class="no">TRT01A</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify the treatment variable within the population</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span> <span class="co"># Create the count layer</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify the variable to determine a distinct count by</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx.x%)'</span>, <span class="no">distinct</span>, <span class="no">distinct_pct</span>)) <span class="co"># Set up the presentation</span>
  )

<span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>))

<span class="fu"><a href="../reference/header_n.html">header_n</a></span>(<span class="no">t</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   TRT01A                   n</span>
<span class="co">#&gt;   &lt;fct&gt;                &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Placebo                 86</span>
<span class="co">#&gt; 2 Xanomeline High Dose    84</span>
<span class="co">#&gt; 3 Xanomeline Low Dose     84</span></pre></body></html></div>
<p>You can see that these counts are indeed coming from ADSL and not ADAE:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">adae</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">SAFFL</span> <span class="kw">==</span> <span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">TRTA</span>, <span class="no">USUBJID</span>) <span class="kw">%&gt;%</span>
  <span class="fu">count</span>(<span class="no">TRTA</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   TRTA                     n</span>
<span class="co">#&gt;   &lt;chr&gt;                &lt;int&gt;</span>
<span class="co">#&gt; 1 Placebo                 21</span>
<span class="co">#&gt; 2 Xanomeline High Dose    42</span>
<span class="co">#&gt; 3 Xanomeline Low Dose     42</span></pre></body></html></div>
<p>Note also the use of the new <code>f_str</code> variable names <code>distinct</code> and <code>distinct_pct</code>. We made these names separate from <code>n</code> and <code>pct</code> to make it explicit when you want to use one type of count or the other. This further allows you to create tables where you mix and match. Consider this common AE table structure:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>, <span class="kw">where</span><span class="kw">=</span> <span class="no">SAFFL</span> <span class="kw">==</span> <span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_data.html">set_pop_data</a></span>(<span class="no">adsl</span>) <span class="kw">%&gt;%</span>  <span class="co"># Specify the population dataset</span>
  <span class="fu"><a href="../reference/pop_treat_var.html">set_pop_treat_var</a></span>(<span class="no">TRT01A</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify the treatment variable within the population</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span> <span class="co"># Create the count layer</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify the variable to determine a distinct count by</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx.x%) [x]'</span>, <span class="no">distinct</span>, <span class="no">distinct_pct</span>, <span class="no">n</span>)) <span class="co"># Set up the presentation - with event counts</span>
  )

<span class="fu">kable</span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>)))</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">1 ( 2.4%) [1]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALOPECIA</td>
<td align="left">1 ( 4.8%) [1]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">BLISTER</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">1 ( 2.4%) [2]</td>
<td align="left">5 (11.9%) [8]</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">COLD SWEAT</td>
<td align="left">1 ( 4.8%) [3]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 ( 4.8%) [1]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="right">1</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS CONTACT</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">0 ( 0.0%) [0]</td>
<td align="left">1 ( 2.4%) [2]</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>In this table, we present the distinct counts by subject, the distinct percent (i.e. number of subjects who experienced an adverse event within the total treatment group, as determined by the population dataset), and then the total number of events. When the population dataset is specified, those N counts from each treatment group will be used within the denominator for <code>distinct_pct</code>. Otherwise, the count within target dataset (in this case, ADAE), of the subjects will be used for <code>distinct_pct</code>.</p>
<p>In addition to population data updates, we’ve also enhanced the capabilities of <code>add_column_headers</code> to work with the <code>header_n</code> values. It’s extremely common to print the header_n counts within your column headers. Now, we’ve made that easy.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>, <span class="kw">where</span><span class="kw">=</span> <span class="no">SAFFL</span> <span class="kw">==</span> <span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pop_data.html">set_pop_data</a></span>(<span class="no">adsl</span>) <span class="kw">%&gt;%</span>  <span class="co"># Specify the population dataset</span>
  <span class="fu"><a href="../reference/pop_treat_var.html">set_pop_treat_var</a></span>(<span class="no">TRT01A</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify the treatment variable within the population</span>
  <span class="fu"><a href="../reference/where.html">set_pop_where</a></span>(<span class="no">SAFFL</span> <span class="kw">==</span> <span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span> <span class="co"># Create the count layer</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify the variable to determine a distinct count by</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx.x%)'</span>, <span class="no">distinct</span>, <span class="no">distinct_pct</span>)) <span class="co"># Set up the presentation</span>
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">starts_with</span>(<span class="st">'ord'</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/add_column_headers.html">add_column_headers</a></span>(<span class="st">' | Placebo N=(**Placebo**) | Xan.Low N=(**Xanomeline High Dose**) | Xan.High N=(**Xanomeline Low Dose**)'</span>,
                     <span class="fu"><a href="../reference/header_n.html">header_n</a></span>(<span class="no">t</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">Placebo N=(86)</td>
<td align="left">Xan.Low N=(84)</td>
<td align="left">Xan.High N=(84)</td>
</tr>
<tr class="even">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">ALOPECIA</td>
<td align="left">1 ( 4.8%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">BLISTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.4%)</td>
<td align="left">5 (11.9%)</td>
</tr>
<tr class="odd">
<td align="left">COLD SWEAT</td>
<td align="left">1 ( 4.8%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 ( 4.8%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
</tbody>
</table>
<p>After the table is built and you order your columns, using <code>add_column_headers</code>, you can extract the header_n’s from your <code>tplyr_table</code> object using the <code>header_n</code> function. Using this as a parameter to <code>add_column_headers</code>, the function will now use the names and values from the <code>header_n</code> output as token replacements. Simply use the names of the <code>header_n</code> vector as your token, surrounded by "**" on both sides. Those values will be replaced as you see in the output above. Any named numeric vector will work in the <code>header_n</code> parameter of <code>add_column_headers</code>, but the <code>header_n</code> function in Tplyr makes this simple.</p>
</div>
<div id="sorting" class="section level2">
<h2 class="hasAnchor">
<a href="#sorting" class="anchor"></a>Sorting</h2>
<p>You may have noticed the addition of <code>ord</code> columns on the datasets output so far. Tplyr now provides order columns built into the table returned to you via the <code>build</code> function. This follows a few basic principles:</p>
<ul>
<li>Each layer will have its own index based on the order in which it was attached to the <code>tplyr_table</code> object.</li>
<li>
<code>by</code> variables will be sorted based on:
<ul>
<li>If there there is a ‘&lt;VAR&gt;N’ variable in the dataset (i.e. RACE &lt;-&gt; RACEN, ETHNIC &lt;-&gt; ETHNICN), then the N variable will used</li>
<li>If no ‘&lt;VAR&gt;N’ variable exists, but the variable is a factor, the factor level order will be used</li>
<li>Otherwise, alphanumeric sorting of the <code>by</code> variable will be used.</li>
</ul>
</li>
</ul>
<p>All layers will function similarly up until this point. The sorting of results is where things differ based on the layer type. Descriptive statistic layers are simple - the order in which the format strings are presented controls the order in which the results will be displayed. This means that if you enter the format strings in the order ‘n’, ‘Mean (SD)’, ‘Median’ - then the rows will order to present the summaries in that order.</p>
<p>Count layers are where things get more complicated. There are multiple scenarios for how one might wish to sort a count table. You may want:</p>
<ul>
<li>Alphanumeric sorting of the target variable</li>
<li>A pre-specified sort order, for things like a disposition table, or AEs of special interest.</li>
<li>To order based on the result of one of the summary count in particular, within a specific treatment group (i.e. descending number of events from the Xanomeline High treatment group).</li>
</ul>
<p>Tplyr’s got your back! We support each of these different scenarios. Let’s use count layers to explore how all of this works</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">RACE</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">SEX</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">ETHNIC</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">SEX</span>)
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">5 ( 5.8%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">WHITE</td>
<td align="left">48 ( 55.8%)</td>
<td align="left">34 ( 40.5%)</td>
<td align="left">44 ( 52.4%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">M</td>
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">WHITE</td>
<td align="left">30 ( 34.9%)</td>
<td align="left">40 ( 47.6%)</td>
<td align="left">34 ( 40.5%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">HISPANIC OR LATINO</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">4 ( 4.8%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">NOT HISPANIC OR LATINO</td>
<td align="left">51 ( 59.3%)</td>
<td align="left">39 ( 46.4%)</td>
<td align="left">46 ( 54.8%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">M</td>
<td align="left">HISPANIC OR LATINO</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">NOT HISPANIC OR LATINO</td>
<td align="left">32 ( 37.2%)</td>
<td align="left">42 ( 50.0%)</td>
<td align="left">32 ( 38.1%)</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>In this very simple example, you see two order columns:</p>
<ul>
<li>ord_layer_index
<ul>
<li>This indicates the layer order. RACE was added first, so the value is 1. ETHNIC was added second, so its layer value is 2.</li>
</ul>
</li>
<li>ord_layer_1
<ul>
<li>This ties back to the by variable SEX. It is indicated as 1 to relate back to row_label1. No SEXN variable is in ADSL, so it sorts alphanumerically, with F coming before M.</li>
</ul>
</li>
<li>order_layer_2
<ul>
<li>This associates with the target variable, which is displayed in row_label2. Note that alphanumeric sorting was using, as these orders do not actually coincide with the RACEN values in the data, and there’s no ETHNICN in the data. The target variable sort order is an area where more caution should be used, so we have helper functions to let you be more explicit in how the target variable sorting should be handled:</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">RACE</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">SEX</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/ordering.html">set_order_count_method</a></span>(<span class="st">'byvarn'</span>) <span class="co"># Specify to look for a RACEN for result sorting</span>
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">ord_layer_index</span>, <span class="no">ord_layer_1</span>, <span class="no">ord_layer_2</span>) <span class="kw">%&gt;%</span> <span class="co"># Sort using the Tplyr order variables</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="left">WHITE</td>
<td align="left">48 ( 55.8%)</td>
<td align="left">34 ( 40.5%)</td>
<td align="left">44 ( 52.4%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">5 ( 5.8%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">WHITE</td>
<td align="left">30 ( 34.9%)</td>
<td align="left">40 ( 47.6%)</td>
<td align="left">34 ( 40.5%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">M</td>
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>RACEN already exists within ADSL. Using the <code>byvarn</code> method of sorting, <code>ord_layer_2</code> is built by simply using the RACEN variable values. This allows you to leverage common variable values already built into CDISC. If you’d like to work in a more R like world, then converting your input variables to ordered factors works as well:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Create a ordered factor for RACE</span>
<span class="no">adsl</span>$<span class="no">RACE</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">adsl</span>$<span class="no">RACE</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'BLACK OR AFRICAN AMERICAN'</span>, <span class="st">'AMERICAN INDIAN OR ALASKA NATIVE'</span>, <span class="st">'WHITE'</span>))

<span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">RACE</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">SEX</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/ordering.html">set_order_count_method</a></span>(<span class="st">'byfactor'</span>) <span class="co"># Specify to use RACE's factor order for the Tplyr order variable</span>
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">ord_layer_index</span>, <span class="no">ord_layer_1</span>, <span class="no">ord_layer_2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">5 ( 5.8%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">WHITE</td>
<td align="left">48 ( 55.8%)</td>
<td align="left">34 ( 40.5%)</td>
<td align="left">44 ( 52.4%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">M</td>
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">WHITE</td>
<td align="left">30 ( 34.9%)</td>
<td align="left">40 ( 47.6%)</td>
<td align="left">34 ( 40.5%)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>And finally, let’s jump to an AE table for the last example - sorting based on the calculated counts. Here, we need some more input from the user to understand what they want:</p>
<ul>
<li>What column do we want a number from</li>
<li>What number within the column should be used</li>
</ul>
<p>Let’s take a look.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx%) [x]'</span>, <span class="no">distinct</span>, <span class="no">pct</span>, <span class="no">n</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/ordering.html">set_order_count_method</a></span>(<span class="st">'bycount'</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify to use the resulting counts for sorting</span>
      <span class="fu"><a href="../reference/ordering.html">set_ordering_cols</a></span>(<span class="st">'Xanomeline High Dose'</span>) <span class="kw">%&gt;%</span> <span class="co"># Use the counts from Xanomeline High Dose treatment group</span>
      <span class="fu"><a href="../reference/ordering.html">set_result_order_var</a></span>(<span class="no">n</span>) <span class="co"># Use the raw numeric value of the n counts</span>
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">1 ( 1%) [1]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALOPECIA</td>
<td align="left">1 ( 2%) [1]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">BLISTER</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">1 ( 2%) [2]</td>
<td align="left">5 ( 7%) [8]</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">COLD SWEAT</td>
<td align="left">1 ( 6%) [3]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 ( 2%) [1]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS CONTACT</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">1 ( 2%) [2]</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Take a look at <code>order_layer_1</code> and compare it to the values within <code>var1_Xanomeline High Dose</code> in the third position. Tplyr pulled out the raw numeric values, so you can use them to sort. Looking through each of the methods:</p>
<ul>
<li>First, you need to specify that you want to use the <code>bycount</code> method of sorting. This tells Tplyr that you’re looking for the raw numeric values.</li>
<li>Next, you need to specify which column from the result variables you want to use. If you use the <code>cols</code> argument, simply provide multiple values, first by using the treatment group value desired, and then the <code>cols</code> arguments in order.</li>
<li>Last, you need to specify which value from the formatted results you want to extract. If not specified, this will default to the first value. Also note, the raw numeric value will be used - not the string formatted value converted back to numeric.</li>
</ul>
<p>Let’s look at one last situation - multi-level count summaries.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="fu">vars</span>(<span class="no">AEBODSYS</span>, <span class="no">AEDECOD</span>)) <span class="kw">%&gt;%</span> <span class="co"># Now doing a multi-level summary</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx%) [x]'</span>, <span class="no">distinct</span>, <span class="no">pct</span>, <span class="no">n</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/ordering.html">set_order_count_method</a></span>(<span class="st">'bycount'</span>) <span class="kw">%&gt;%</span> <span class="co"># Specify to use the resulting counts for sorting</span>
      <span class="fu"><a href="../reference/ordering.html">set_ordering_cols</a></span>(<span class="st">'Xanomeline High Dose'</span>) <span class="kw">%&gt;%</span> <span class="co"># Use the counts from Xanomeline High Dose treatment group</span>
      <span class="fu"><a href="../reference/ordering.html">set_result_order_var</a></span>(<span class="no">n</span>) <span class="co"># Use the raw numeric value of the n counts</span>
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">21 (100%) [47]</td>
<td align="left">42 (100%) [111]</td>
<td align="left">42 (100%) [118]</td>
<td align="right">1</td>
<td align="right">111</td>
<td align="right">Inf</td>
</tr>
<tr class="even">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">1 ( 1%) [1]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">111</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">ALOPECIA</td>
<td align="left">1 ( 2%) [1]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">111</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">BLISTER</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">1 ( 2%) [2]</td>
<td align="left">5 ( 7%) [8]</td>
<td align="right">1</td>
<td align="right">111</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">COLD SWEAT</td>
<td align="left">1 ( 6%) [3]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">111</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 ( 2%) [1]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="left">0 ( 0%) [0]</td>
<td align="right">1</td>
<td align="right">111</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Tplyr can handle these as well, but this is an area we’re going to improve in the next release. Currently, Tplyr defaults to using the VARN/Factor/alphanumeric sorting method for the outer variable, AEBODSYS (just like the <code>by</code> variables, starting with searching for a &lt;VAR&gt;N variable, then to factor variable, last to alphanumeric). For the inside variable, the specified sorting method is used. This currently covers many situations just fine - but we’re going to add the additional flexibility to allow count based sorting for both the inside and outside variable.</p>
<p>Figuring out how we wanted to approach sorting was itself quite a large task, as we constantly try to balance flexibility with complexity of use. Implementing these order methods was an even larger task. Kudos to Eli for getting this as far as we have!</p>
<p>While we’re on the subject of multi-level counts, we’ve also added some enhanced capabilities for presenting these situations by offering nesting - as you can see in the summary above. The second variable is nested inside the first. You’re able to turn this setting off:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="fu">vars</span>(<span class="no">AEBODSYS</span>, <span class="no">AEDECOD</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_nest_count.html">set_nest_count</a></span>(<span class="fl">FALSE</span>)
  )

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   row_label1 row_label2 var1_Placebo `var1_Xanomelin… `var1_Xanomelin…</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;           </span>
<span class="co">#&gt; 1 SKIN AND … "SKIN AND… " 47 (100.0… "111 (100.0%)"   "118 (100.0%)"  </span>
<span class="co">#&gt; 2 SKIN AND … "   ACTIN… "  0 (  0.0… "  1 (  0.9%)"   "  0 (  0.0%)"  </span>
<span class="co">#&gt; 3 SKIN AND … "   ALOPE… "  1 (  2.1… "  0 (  0.0%)"   "  0 (  0.0%)"  </span>
<span class="co">#&gt; 4 SKIN AND … "   BLIST… "  0 (  0.0… "  2 (  1.8%)"   "  8 (  6.8%)"  </span>
<span class="co">#&gt; 5 SKIN AND … "   COLD … "  3 (  6.4… "  0 (  0.0%)"   "  0 (  0.0%)"  </span>
<span class="co">#&gt; 6 SKIN AND … "   DERMA… "  1 (  2.1… "  0 (  0.0%)"   "  0 (  0.0%)"  </span>
<span class="co">#&gt; # … with 3 more variables: ord_layer_index &lt;int&gt;, ord_layer_1 &lt;int&gt;,</span>
<span class="co">#&gt; #   ord_layer_2 &lt;dbl&gt;</span></pre></body></html></div>
<p>You can also change the character used to set the indentation, which defaults to <code>\t</code> for a tab.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="fu">vars</span>(<span class="no">AEBODSYS</span>, <span class="no">AEDECOD</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/set_indentation.html">set_indentation</a></span>(<span class="st">"---&gt;"</span>)

<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">47 (100.0%)</td>
<td align="left">111 (100.0%)</td>
<td align="left">118 (100.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">Inf</td>
</tr>
<tr class="even">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">—&gt;ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 0.9%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">—&gt;ALOPECIA</td>
<td align="left">1 ( 2.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">—&gt;BLISTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 ( 1.8%)</td>
<td align="left">8 ( 6.8%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">—&gt;COLD SWEAT</td>
<td align="left">3 ( 6.4%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">SKIN AND SUBCUTANEOUS TISSUE DISORDERS</td>
<td align="left">—&gt;DERMATITIS ATOPIC</td>
<td align="left">1 ( 2.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
</div>
<div id="risk-difference" class="section level2">
<h2 class="hasAnchor">
<a href="#risk-difference" class="anchor"></a>Risk difference</h2>
<p>Tplyr does not support, nor do we intended to support, a wide array of statistical methods. Our goal is rather to take your focus as an analyst off the mundane summaries so you can focus on the interesting analysis. That said, there are some things that are common enough that we feel that it’s reasonable for us to include. So let’s take a look at risk difference.</p>
<p>Our current implementation of risk difference is solely built on top of the base R function <code>prop.test</code>. For any and all questions about this method, please review the <code>prop.test</code> documentation within R.</p>
<p>Risk difference is built on top of count layers, as it’s a comparison of proportions. To add risk difference into a count layer, you simply use the function <code>add_risk_diff</code>. We made a large effort to make this flow very naturally with the count layer construction, so let’s walk through it step by step.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="st">'USUBJID'</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_risk_diff.html">add_risk_diff</a></span>(
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Xanomeline High Dose'</span>, <span class="st">'Placebo'</span>),
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Xanomeline Low Dose'</span>, <span class="st">'Placebo'</span>)
      )
  )

<span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="left">rdiff_Xanomeline High Dose_Placebo</th>
<th align="left">rdiff_Xanomeline Low Dose_Placebo</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( Inf%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALOPECIA</td>
<td align="left">1 (100.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">BLISTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( Inf%)</td>
<td align="left">1 ( Inf%)</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">COLD SWEAT</td>
<td align="left">1 (100.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 (100.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS CONTACT</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( Inf%)</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>Comparisons are specified with two-element character vectors. These are simply your comparison group - the first element, and your reference group - the second. This coincides with how you might see risk difference specified in the header of your mock, where you’ll see something like T1-Placebo. You can provide as many comparisons as you want - the values specified in the comparison just need to be valid treatment groups within your data. This works with any treatment group built using <code>add_treat_group</code> or <code>add_total_group</code> as well.</p>
<p>The risk difference calculations are displayed in the <code>rdiff</code> columns. There will be an <code>rdiff</code> column for every comparison that is made, following the convention <code>rdiff_&lt;comparison&gt;_&lt;reference&gt;</code>.</p>
<p>Note the use of <code>suppressWarnings</code> - if the counts used in <code>prop.test</code> are too low, you’ll get a warning that says “Chi-squared approximation may be incorrect” for every time <code>prop.test</code> is run with counts that are too low… This could happen a lot, but the warning is perfectly valid.</p>
<p>The default values that are displayed will be:</p>
<ul>
<li>The difference</li>
<li>95% confidence interval low</li>
<li>95% confidence interval high</li>
</ul>
<p>You have a good bit of control over these values though, and this can be controlled in the same way you format the count summaries - using <code>set_format_strings</code>.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="st">'USUBJID'</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_risk_diff.html">add_risk_diff</a></span>(
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Xanomeline High Dose'</span>, <span class="st">'Placebo'</span>),
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Xanomeline Low Dose'</span>, <span class="st">'Placebo'</span>)
      ) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'n_counts'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx.x) [x]'</span>, <span class="no">distinct</span>, <span class="no">distinct_pct</span>, <span class="no">n</span>),
        <span class="st">'riskdiff'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx.xxx, xx.xxx, xx.xxx, xx.xxx, xx.xxx'</span>, <span class="no">comp</span>, <span class="no">ref</span>, <span class="no">dif</span>, <span class="no">low</span>, <span class="no">high</span>)
      )
  )

<span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="left">rdiff_Xanomeline High Dose_Placebo</th>
<th align="left">rdiff_Xanomeline Low Dose_Placebo</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">1 ( Inf) [1]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALOPECIA</td>
<td align="left">1 (100.0) [1]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">BLISTER</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">1 ( Inf) [2]</td>
<td align="left">1 ( Inf) [8]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">COLD SWEAT</td>
<td align="left">1 (100.0) [3]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 (100.0) [1]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS CONTACT</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">1 ( Inf) [2]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>Take a look at the <code>rdiff</code> columns now - you’ll see they have 5 values. These are:</p>
<ul>
<li>The comparison proportion (i.e. the estimate[1] output from a <code>prop.test</code> object)</li>
<li>The reference proportion (i.e. the estimate[2] output from a <code>prop.test</code> object)</li>
<li>The difference (i.e. estimate[1] - estimate[2])</li>
<li>The lower end of the confidence interval</li>
<li>The upper end of the confidence interval</li>
</ul>
<p>You have the same control over the formatting of the display of these values here as you do with the count summaries. Taking things a step further, you can also pass forward arguments to <code>prop.test</code> using a named list and the <code>args</code> argument in <code>add_risk_diff</code>. This wasn’t done using the ellipsis (i.e. <code>...</code>) like typical R functions because it’s already used to capture a varying number of comparisons, but it’s not much more difficult to use:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="st">'USUBJID'</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_risk_diff.html">add_risk_diff</a></span>(
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Xanomeline High Dose'</span>, <span class="st">'Placebo'</span>),
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Xanomeline Low Dose'</span>, <span class="st">'Placebo'</span>),
        <span class="kw">args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">conf.level</span><span class="kw">=</span><span class="fl">0.95</span>, <span class="kw">alternative</span><span class="kw">=</span><span class="st">'less'</span>, <span class="kw">correct</span><span class="kw">=</span><span class="fl">FALSE</span>)
      ) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'n_counts'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx (xx.x) [x]'</span>, <span class="no">distinct</span>, <span class="no">distinct_pct</span>, <span class="no">n</span>),
        <span class="st">'riskdiff'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx.xxx, xx.xxx, xx.xxx, xx.xxx, xx.xxx'</span>, <span class="no">comp</span>, <span class="no">ref</span>, <span class="no">dif</span>, <span class="no">low</span>, <span class="no">high</span>)
      )
  )

<span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="fu"><a href="../reference/build.html">build</a></span>(<span class="no">t</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="left">rdiff_Xanomeline High Dose_Placebo</th>
<th align="left">rdiff_Xanomeline Low Dose_Placebo</th>
<th align="right">ord_layer_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">1 ( Inf) [1]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALOPECIA</td>
<td align="left">1 (100.0) [1]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">BLISTER</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">1 ( Inf) [2]</td>
<td align="left">1 ( Inf) [8]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">COLD SWEAT</td>
<td align="left">1 (100.0) [3]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 (100.0) [1]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS CONTACT</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">0 ( 0.0) [0]</td>
<td align="left">1 ( Inf) [2]</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>One more note - the default of <code>add_risk_diff</code> works on the distinct counts available within the count summary. If for whatever reason you’d like to run risk difference on the non-distinct counts, switch the <code>distinct</code> argument to FALSE. <code>add_risk_diff</code> also will function on multi-level summaries no different than single level, so no concerns there either.</p>
</div>
<div id="descriptive-statistic-layer-updates" class="section level2">
<h2 class="hasAnchor">
<a href="#descriptive-statistic-layer-updates" class="anchor"></a>Descriptive Statistic Layer Updates</h2>
<p>You can see that there was a lot of attention given to counting over the past three weeks - but descriptive statistics weren’t neglected either. Let’s start simple - custom summaries no work properly on multi-variable summaries:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="fu">vars</span>(<span class="no">AGE</span>, <span class="no">HEIGHTBL</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">"Sepal Length"</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_custom_summaries.html">set_custom_summaries</a></span>(
        <span class="kw">geometric_mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">.var</span>[<span class="no">.var</span> <span class="kw">&gt;</span> <span class="fl">0</span>]), <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>) / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.var</span>))
      ) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Geometric Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'xx.xx (xx.xxx)'</span>, <span class="no">geometric_mean</span>, <span class="no">sd</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="left">var2_Placebo</th>
<th align="left">var2_Xanomeline High Dose</th>
<th align="left">var2_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Sepal Length</td>
<td align="left">Geometric Mean (SD)</td>
<td align="left">74.70 ( 8.590)</td>
<td align="left">73.94 ( 7.886)</td>
<td align="left">75.18 ( 8.286)</td>
<td align="left">162.17 (11.522)</td>
<td align="left">165.51 (10.131)</td>
<td align="left">163.11 (10.419)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p>Not much more to it! Just use <code>.var</code> instead of the a distinct variable name.</p>
<div id="auto-precision" class="section level3">
<h3 class="hasAnchor">
<a href="#auto-precision" class="anchor"></a>Auto Precision</h3>
<p>The more interesting development for descriptive statistics was the addition of auto-precision. Auto-precision allows you to format your numeric summaries based on the precision of the data collected. Particularly when working with labs results, different tests may have difference necessities for decimal precision depending on the numeric range of the tests, the units the data are collected in, etc. So it is common practice to vary the precision of the data being presented based on the data collected. Furthermore, depending on the summary being presented, you may wish to increase the precision further. For example, you may want the mean to be at collected precision +1 decimal place, for standard deviation +2.</p>
<p>Tplyr now handles these cases, and in Tplyr style, it’s intuitive and easy to control. This has all been built into the format strings, because a natural place to specify your desired format is where you specify how you want your data presented. Now - if you wish to use auto-precision, use <code>a</code> instead of <code>x</code> when creating your summaries. Note that only one <code>a</code> is needed. To use increased precision, use <code>a+n</code> where <code>n</code> is the number of additional spaces you wish to add.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r">
<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'a.a+1 (a.a+2)'</span>, <span class="no">mean</span>, <span class="no">sd</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">9.393 ( 3.6958)</td>
<td align="left">11.067 ( 5.5859)</td>
<td align="left">9.345 ( 4.4788)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CA</td>
<td align="left">Mean (SD)</td>
<td align="left">2.293335 (0.0858524)</td>
<td align="left">2.285420 (0.1057115)</td>
<td align="left">2.283501 (0.1051777)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CHOL</td>
<td align="left">Mean (SD)</td>
<td align="left">5.484638 (0.9675922)</td>
<td align="left">5.455632 (0.9118730)</td>
<td align="left">5.444922 (0.9110347)</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">GLUC</td>
<td align="left">Mean (SD)</td>
<td align="left">5.769956 ( 1.6656594)</td>
<td align="left">5.826759 ( 2.1917258)</td>
<td align="left">5.632735 ( 2.3769385)</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SODIUM</td>
<td align="left">Mean (SD)</td>
<td align="left">140.6 ( 2.43)</td>
<td align="left">140.4 ( 2.96)</td>
<td align="left">141.0 ( 2.70)</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>As you can see, the decimal precision is now varying depending on the test being performed. Notice that both the integer and the decimal side of each number fluctuate as well. Tpylr collects both the integer and decimal precision, and you can specify both separately. For example, you could use <code>x</code>’s to specify a default number of spaces for your integers that are used consistently across by variables, but vary the decimal precision based on collected data. You can also increment the number of spaces for both integer and decimal separately.</p>
<p>But - this is kind of ugly, isn’t it? Do we really need all 5 decimal places collected for CA? For this reason, you’re able to set a cap on the precision that’s displayed:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="no">AVAL</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">PARAMCD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'a.a+1 (a.a+2)'</span>, <span class="no">mean</span>, <span class="no">sd</span>),
        <span class="kw">cap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">int</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">dec</span><span class="kw">=</span><span class="fl">2</span>)
      )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">9.393 ( 3.6958)</td>
<td align="left">11.067 ( 5.5859)</td>
<td align="left">9.345 ( 4.4788)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CA</td>
<td align="left">Mean (SD)</td>
<td align="left">2.293 (0.0859)</td>
<td align="left">2.285 (0.1057)</td>
<td align="left">2.284 (0.1052)</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CHOL</td>
<td align="left">Mean (SD)</td>
<td align="left">5.485 (0.9676)</td>
<td align="left">5.456 (0.9119)</td>
<td align="left">5.445 (0.9110)</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">GLUC</td>
<td align="left">Mean (SD)</td>
<td align="left">5.770 ( 1.6657)</td>
<td align="left">5.827 ( 2.1917)</td>
<td align="left">5.633 ( 2.3769)</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SODIUM</td>
<td align="left">Mean (SD)</td>
<td align="left">140.6 ( 2.43)</td>
<td align="left">140.4 ( 2.96)</td>
<td align="left">141.0 ( 2.70)</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Now that looks better. The <code>cap</code> argument is part of <code>set_format_strings</code>. You need to specify the integer and decimal caps separately. Note that integer precision might not behave like you expect - it doesn’t make sense to truncate an integer if it’s value is too high, so if the integer exceeds the allotted space, then the length of the string will increase and the full value will be displayed. But values that are short enough will only pad to the capped number of spaces. We plan to implement a warning in future releases if integers exceed the set display space allocation.</p>
<p>This was a basic situation, but if you’re paying close attention, you may have some questions. What if you have more by variables, like by visit AND test. Do we then calculate precision by visit and test? What if collected precision is different per visit and we don’t want that? What about multiple summary variable? How do we determine precision then? We have modifier functions for this:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>, <span class="kw">where</span> <span class="kw">=</span> <span class="no">SAFFL</span><span class="kw">==</span><span class="st">'Y'</span> <span class="kw">&amp;</span> <span class="no">AVISIT</span> <span class="kw">!=</span> <span class="st">''</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_desc</a></span>(<span class="fu">vars</span>(<span class="no">AVAL</span>, <span class="no">CHG</span>, <span class="no">BASE</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu">vars</span>(<span class="no">AVISIT</span>,<span class="no">PARAMCD</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(
        <span class="st">'Mean (SD)'</span> <span class="kw">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">'a.a+1 (a.a+2)'</span>, <span class="no">mean</span>, <span class="no">sd</span>),
        <span class="kw">cap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">int</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">dec</span><span class="kw">=</span><span class="fl">2</span>)
      ) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/precision_on.html">set_precision_on</a></span>(<span class="no">AVAL</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/precision_by.html">set_precision_by</a></span>(<span class="no">PARAMCD</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">row_label3</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="left">var2_Placebo</th>
<th align="left">var2_Xanomeline High Dose</th>
<th align="left">var2_Xanomeline Low Dose</th>
<th align="left">var3_Placebo</th>
<th align="left">var3_Xanomeline High Dose</th>
<th align="left">var3_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
<th align="right">ord_layer_3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">End of Treatment</td>
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">7.866 ( 2.5933)</td>
<td align="left">10.530 ( 5.2633)</td>
<td align="left">10.165 ( 4.5986)</td>
<td align="left">-1.368 ( 3.0589)</td>
<td align="left">0.450 ( 3.6871)</td>
<td align="left">-0.570 ( 2.5566)</td>
<td align="left">9.234 ( 1.5295)</td>
<td align="left">10.080 ( 2.9560)</td>
<td align="left">10.735 ( 3.5583)</td>
<td align="right">1</td>
<td align="right">99</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">End of Treatment</td>
<td align="left">CA</td>
<td align="left">Mean (SD)</td>
<td align="left">2.270 (0.0966)</td>
<td align="left">2.309 (0.1235)</td>
<td align="left">2.284 (0.0790)</td>
<td align="left">-0.025 (0.0789)</td>
<td align="left">-0.009 (0.1132)</td>
<td align="left">-0.006 (0.0703)</td>
<td align="left">2.295 (0.1433)</td>
<td align="left">2.318 (0.0868)</td>
<td align="left">2.290 (0.0841)</td>
<td align="right">1</td>
<td align="right">99</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">End of Treatment</td>
<td align="left">CHOL</td>
<td align="left">Mean (SD)</td>
<td align="left">5.027 (0.7384)</td>
<td align="left">5.398 (0.8753)</td>
<td align="left">5.646 (0.7619)</td>
<td align="left">-0.367 (0.5952)</td>
<td align="left">-0.543 (0.7285)</td>
<td align="left">-0.264 (0.4187)</td>
<td align="left">5.394 (1.0972)</td>
<td align="left">5.941 (1.2632)</td>
<td align="left">5.910 (0.6593)</td>
<td align="right">1</td>
<td align="right">99</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">End of Treatment</td>
<td align="left">GLUC</td>
<td align="left">Mean (SD)</td>
<td align="left">5.096 ( 0.1729)</td>
<td align="left">5.481 ( 2.1280)</td>
<td align="left">5.140 ( 1.0885)</td>
<td align="left">0.255 ( 0.2592)</td>
<td align="left">0.339 ( 1.3285)</td>
<td align="left">-0.176 ( 1.2386)</td>
<td align="left">4.840 ( 0.3051)</td>
<td align="left">5.142 ( 1.1460)</td>
<td align="left">5.316 ( 0.7493)</td>
<td align="right">1</td>
<td align="right">99</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">End of Treatment</td>
<td align="left">SODIUM</td>
<td align="left">Mean (SD)</td>
<td align="left">141.0 ( 2.35)</td>
<td align="left">140.6 ( 3.76)</td>
<td align="left">142.3 ( 2.47)</td>
<td align="left">-0.2 ( 4.87)</td>
<td align="left">0.4 ( 4.76)</td>
<td align="left">2.7 ( 3.06)</td>
<td align="left">141.2 ( 2.95)</td>
<td align="left">140.3 ( 2.60)</td>
<td align="left">139.6 ( 2.45)</td>
<td align="right">1</td>
<td align="right">99</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Week 12</td>
<td align="left">BILI</td>
<td align="left">Mean (SD)</td>
<td align="left">9.545 ( 3.5615)</td>
<td align="left">11.525 ( 6.1588)</td>
<td align="left">8.785 ( 4.1468)</td>
<td align="left">-0.128 ( 2.8289)</td>
<td align="left">-0.274 ( 4.7790)</td>
<td align="left">0.103 ( 2.6403)</td>
<td align="left">9.673 ( 3.6524)</td>
<td align="left">11.799 ( 6.0458)</td>
<td align="left">8.755 ( 3.1595)</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>Three variables are being summarized here - AVAL, CHG, and BASE. So which should be used for precision? <code>set_precision_on</code> allows you to specify this, where the <code>precision_on</code> variable must be one of the variables within <code>target_var</code>. Similarly, <code>set_precision_by</code> changes the <code>by</code> variables used to determine collected precision. If no <code>precision_on</code> variable is specified, the first variable in <code>target_var</code> is used. If not <code>precision_by</code> variables are specified, then the default <code>by</code> variables are used.</p>
</div>
</div>
</div>
<div id="next-steps" class="section level1">
<h1 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next Steps</h1>
<p>Our next release of Tplyr will be our first full release. This means that:</p>
<ul>
<li>We will be posting to CRAN</li>
<li>We’re going to include a full and indpendently tested UAT document</li>
<li>We’ll have a full suite of vignettes included to enhance our available documentation</li>
</ul>
<p>The next wave of updates is mostly going to be tweaks and sugar, where we will try to make sure that Tplyr is as user friendly and practical as possible. In the mean time, if you have any comments, feedback, or find some bugs - drop us an issue. We’d love to hear any feedback if you’ve taken Tplyr for a test drive.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eli Miller, Mike Stackhouse, Ashley Tarasiewicz, Nathan Kosiba.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
