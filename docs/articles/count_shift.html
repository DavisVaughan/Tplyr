<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Count and Shift Tables • Tplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Count and Shift Tables">
<meta property="og:description" content="Tplyr">
<meta property="og:image" content="/reference/figures/Atorus_Stickers_vF_Tplyr.png">
<meta property="og:image:alt" content="Tplyr Hex Sticker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@AtorusR">
<meta name="twitter:site" content="@AtorusR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Tplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Tplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Layer Vignettes</li>
    <li>
      <a href="../articles/desc-vignette.html">Descriptive Statistic Layers</a>
    </li>
    <li>
      <a href="../articles/count_shift.html">Count and Shift Tables</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Helpers</li>
    <li>
      <a href="../articles/riskdiff.html">Risk Difference</a>
    </li>
    <li>
      <a href="../articles/sort.html">Sorting a Tplyr Table</a>
    </li>
    <li>
      <a href="../articles/options-vignette.html">Tplyr Options</a>
    </li>
    <li>
      <a href="../articles/styled-table.html">Producing a Styled Table</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Release Vignettes</li>
    <li>
      <a href="../articles/alpha-release.html">Tplyr (Alpha Release)</a>
    </li>
    <li>
      <a href="../articles/beta-release.html">Tplyr (Beta Release)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atorus-research/Tplyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="count_shift_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Count and Shift Tables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atorus-research/Tplyr/blob/master/vignettes/count_shift.Rmd"><code>vignettes/count_shift.Rmd</code></a></small>
      <div class="hidden name"><code>count_shift.Rmd</code></div>

    </div>

    
    
<div id="frequency-tables" class="section level1">
<h1 class="hasAnchor">
<a href="#frequency-tables" class="anchor"></a>Frequency Tables</h1>
<p>At the surface, counting sounds pretty simple, right? You just want to know how many occurrences of something there are. Well - unfortunately, it’s not that easy. And in clinical reports, there’s quite a bit of nuance that goes into the different types of frequency tables that need to be created. Fortunately, we’ve added a good bit of flexibility into both <code><a href="../reference/layer_constructors.html">group_count()</a></code> and <code><a href="../reference/layer_constructors.html">group_shift()</a></code> to help you get what you need when creating these reports, whether you’re creating a demographics table, adverse events, of shift in lab results.</p>
<div id="a-simple-example" class="section level3">
<h3 class="hasAnchor">
<a href="#a-simple-example" class="anchor"></a>A simple example</h3>
<p>Let’s start with a basic example. This table demonstrates the distribution of subject disposition across treatment groups. Additionally, we’re sorting by descending total occurrences using the <code>Total</code> group.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adsl</span>, <span class="no">TRT01P</span>, <span class="kw">where</span> <span class="kw">=</span> <span class="no">SAFFL</span> <span class="kw">==</span> <span class="st">"Y"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/treat_grps.html">add_total_group</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/treat_grps.html">add_treat_grps</a></span>(<span class="kw">Treated</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Xanomeline Low Dose"</span>, <span class="st">"Xanomeline High Dose"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">DCDECOD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/ordering.html">set_order_count_method</a></span>(<span class="st">"bycount"</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/ordering.html">set_ordering_cols</a></span>(<span class="no">Total</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">ord_layer_1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"row"</span>), <span class="no">var1_Placebo</span>, <span class="no">`var1_Xanomeline Low Dose`</span>,
         <span class="no">`var1_Xanomeline High Dose`</span>, <span class="no">var1_Treated</span>, <span class="no">var1_Total</span>)

<span class="fu">kable</span>(<span class="no">t</span>, <span class="st">"html"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">column_spec</span>(<span class="fl">6</span>, <span class="st">"3cm"</span>)</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
row_label1
</th>
<th style="text-align:left;">
var1_Placebo
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose
</th>
<th style="text-align:left;">
var1_Treated
</th>
<th style="text-align:left;">
var1_Total
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
COMPLETED
</td>
<td style="text-align:left;">
58 ( 67.4%)
</td>
<td style="text-align:left;">
25 ( 29.8%)
</td>
<td style="text-align:left;">
27 ( 32.1%)
</td>
<td style="text-align:left;">
52 ( 31.0%)
</td>
<td style="text-align:left;width: 3cm; ">
110 ( 43.3%)
</td>
</tr>
<tr>
<td style="text-align:left;">
ADVERSE EVENT
</td>
<td style="text-align:left;">
8 ( 9.3%)
</td>
<td style="text-align:left;">
44 ( 52.4%)
</td>
<td style="text-align:left;">
40 ( 47.6%)
</td>
<td style="text-align:left;">
84 ( 50.0%)
</td>
<td style="text-align:left;width: 3cm; ">
92 ( 36.2%)
</td>
</tr>
<tr>
<td style="text-align:left;">
WITHDRAWAL BY SUBJECT
</td>
<td style="text-align:left;">
9 ( 10.5%)
</td>
<td style="text-align:left;">
10 ( 11.9%)
</td>
<td style="text-align:left;">
8 ( 9.5%)
</td>
<td style="text-align:left;">
18 ( 10.7%)
</td>
<td style="text-align:left;width: 3cm; ">
27 ( 10.6%)
</td>
</tr>
<tr>
<td style="text-align:left;">
STUDY TERMINATED BY SPONSOR
</td>
<td style="text-align:left;">
2 ( 2.3%)
</td>
<td style="text-align:left;">
2 ( 2.4%)
</td>
<td style="text-align:left;">
3 ( 3.6%)
</td>
<td style="text-align:left;">
5 ( 3.0%)
</td>
<td style="text-align:left;width: 3cm; ">
7 ( 2.8%)
</td>
</tr>
<tr>
<td style="text-align:left;">
PROTOCOL VIOLATION
</td>
<td style="text-align:left;">
2 ( 2.3%)
</td>
<td style="text-align:left;">
1 ( 1.2%)
</td>
<td style="text-align:left;">
3 ( 3.6%)
</td>
<td style="text-align:left;">
4 ( 2.4%)
</td>
<td style="text-align:left;width: 3cm; ">
6 ( 2.4%)
</td>
</tr>
<tr>
<td style="text-align:left;">
LACK OF EFFICACY
</td>
<td style="text-align:left;">
3 ( 3.5%)
</td>
<td style="text-align:left;">
0 ( 0.0%)
</td>
<td style="text-align:left;">
1 ( 1.2%)
</td>
<td style="text-align:left;">
1 ( 0.6%)
</td>
<td style="text-align:left;width: 3cm; ">
4 ( 1.6%)
</td>
</tr>
<tr>
<td style="text-align:left;">
DEATH
</td>
<td style="text-align:left;">
2 ( 2.3%)
</td>
<td style="text-align:left;">
1 ( 1.2%)
</td>
<td style="text-align:left;">
0 ( 0.0%)
</td>
<td style="text-align:left;">
1 ( 0.6%)
</td>
<td style="text-align:left;width: 3cm; ">
3 ( 1.2%)
</td>
</tr>
<tr>
<td style="text-align:left;">
PHYSICIAN DECISION
</td>
<td style="text-align:left;">
1 ( 1.2%)
</td>
<td style="text-align:left;">
0 ( 0.0%)
</td>
<td style="text-align:left;">
2 ( 2.4%)
</td>
<td style="text-align:left;">
2 ( 1.2%)
</td>
<td style="text-align:left;width: 3cm; ">
3 ( 1.2%)
</td>
</tr>
<tr>
<td style="text-align:left;">
LOST TO FOLLOW-UP
</td>
<td style="text-align:left;">
1 ( 1.2%)
</td>
<td style="text-align:left;">
1 ( 1.2%)
</td>
<td style="text-align:left;">
0 ( 0.0%)
</td>
<td style="text-align:left;">
1 ( 0.6%)
</td>
<td style="text-align:left;width: 3cm; ">
2 ( 0.8%)
</td>
</tr>
</tbody>
</table>
</div>
<div id="percentages" class="section level2">
<h2 class="hasAnchor">
<a href="#percentages" class="anchor"></a>Percentages</h2>
<p>Counting is one thing - but a count by itself doesn’t give much context. Often frequencies in clinical reports are paired with a percentage, which allows you to understand the proportion of events/subjects to some total - but that total can prove to be complicated, which is why we’ve included a few functions to aid in giving you the necessary denominator.</p>
<ul>
<li>
<code><a href="../reference/set_denoms_by.html">set_denoms_by()</a></code> function allows users calculate denominators using any variable within the by, cols, treatment, or target variables. This defaults to all variables passed as treatment groups and column variables which causes the column percentages to sum to 100%. This is particularly useful for shift tables, which use a combination of row and column variables.
<ul>
<li>
<code><a href="../reference/set_denom_ignore.html">set_denom_ignore()</a></code> defines values of the target variable to be ignored in the calculation of the denominator. In many tables percentages are based on non-missing counts. You can pass values to this function to have them be excluded from the calculation of the denominator. For example, if your data include NAs, you can use “NA” in <code><a href="../reference/set_denom_ignore.html">set_denom_ignore()</a></code> and those will be excluded from the denominator.</li>
</ul>
</li>
</ul>
<p>Examples with percentages can be seen below.</p>
</div>
<div id="distinct-versus-event-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#distinct-versus-event-counts" class="anchor"></a>Distinct Versus Event Counts</h2>
<p>Just as important as denominator flexibility is the determination of whether you should be using distinct or non-distinct counts - or some combination of both. Adverse event tables are a perfect example. Often, you’re concerned about how many subjects had an adverse event in particular instead of just the number of occurrences of that adverse event. Similarly, the number occurrences of an event isn’t necessarily relevant when compared to the total number of adverse events that occurred. For this reason, what you likely want to look at is instead the number of subjects who experienced an event compared to the total number of subjects in that treatment group.</p>
<p>‘Tplyr’ allows you to focus on these distinct counts and distinct percents within some grouping variable, like subject. Additionally, you can mix and match with the non-distinct counts too. The <code>set_distinct_by</code> function sets the variables used to calculate the distinct occurrences of some value using the specified ‘by’ variables.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AEDECOD</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_distinct_by.html">set_distinct_by</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xxx (xx.xx%) [xxx]"</span>, <span class="no">distinct</span>, <span class="no">distinct_pct</span>, <span class="no">n</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()

<span class="fu">kable</span>(<span class="no">t</span>)</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
row_label1
</th>
<th style="text-align:left;">
var1_Placebo
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose
</th>
<th style="text-align:right;">
ord_layer_index
</th>
<th style="text-align:right;">
ord_layer_1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ABDOMINAL PAIN
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
1 ( 2.00%) [ 1]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
AGITATION
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
1 ( 2.00%) [ 1]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
ANXIETY
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
1 ( 2.00%) [ 1]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
APPLICATION SITE DERMATITIS
</td>
<td style="text-align:left;">
1 ( 3.12%) [ 1]
</td>
<td style="text-align:left;">
3 ( 6.98%) [ 3]
</td>
<td style="text-align:left;">
2 ( 4.00%) [ 2]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
APPLICATION SITE ERYTHEMA
</td>
<td style="text-align:left;">
0 ( 0.00%) [ 0]
</td>
<td style="text-align:left;">
3 ( 6.98%) [ 3]
</td>
<td style="text-align:left;">
4 ( 8.00%) [ 4]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
APPLICATION SITE IRRITATION
</td>
<td style="text-align:left;">
1 ( 3.12%) [ 1]
</td>
<td style="text-align:left;">
3 ( 6.98%) [ 4]
</td>
<td style="text-align:left;">
2 ( 4.00%) [ 2]
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p>You may have seen tables before like the one about. This display shows the number of subjects who experienced an adverse event, the percentage of subjects within the given treatment group who experienced that event, and then the total number of occurrences of that event. Using <code><a href="../reference/set_distinct_by.html">set_distinct_by()</a></code> triggered the derivation distinct_n and distinct_pct and the display of the values is then controlled by the <code><a href="../reference/f_str.html">f_str()</a></code> call in <code>set_format_strings</code>.</p>
</div>
<div id="missing-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#missing-counts" class="anchor"></a>Missing Counts</h2>
<p>Missing counts are another tricky area for frequency tables. These values raise a number of questions. For example, do you want to format the missing counts the same way as the event counts? Do you want to present missing counts with percentages? Do missing counts belong in the denominator?</p>
<p>The <code><a href="../reference/set_missing_count.html">set_missing_count()</a></code> function can take a new <code>f_str</code> object to set the display of missing values. Additionally, using the <code>string</code> parameter you can set the value chosen to be summarized as missing, and by using a named character vector, you can control the row_label of what will be used for missing values.</p>
<p>The example below 50 random values are removed and NA is specified as the missing string. It also ignores that value in the denominator using <code><a href="../reference/set_denom_ignore.html">set_denom_ignore()</a></code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">adae2</span> <span class="kw">&lt;-</span> <span class="no">adae</span>
<span class="no">adae2</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">200</span>, <span class="fl">50</span>), <span class="st">"AESEV"</span>] <span class="kw">&lt;-</span> <span class="fl">NA</span>
<span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae2</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="no">AESEV</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xxx (xx.xx%)"</span>, <span class="no">n</span>, <span class="no">pct</span>)) <span class="kw">%&gt;%</span>
      <span class="co"># AESEV of SEVERE is used to demonstrate missing</span>
      <span class="fu"><a href="../reference/set_missing_count.html">set_missing_count</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xxx"</span>, <span class="no">n</span>), <span class="kw">string</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">MISSING</span> <span class="kw">=</span> <span class="st">"NA"</span>))  <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_denom_ignore.html">set_denom_ignore</a></span>(<span class="st">"NA"</span>)

  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
</div>
<div id="nested-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#nested-counts" class="anchor"></a>Nested Counts</h2>
<p>In certain tables, one variable is a grouping factor of another. Just using a ‘target’ variable and a ‘by’ variable here isn’t sufficient, that would produce every combination of the ‘by’ and ‘target’ variables. Tplyr allows you to pass two variables as ‘target’ variables using <code><a href="https://dplyr.tidyverse.org/reference/vars.html">dplyr::vars()</a></code>. The first variable is treated as the ‘grouping’ variable and the values of the second variable are ‘nested’ into the first variable and counts are created for both groups separately.</p>
<p>This example is filter to display only the first group. Note that the only “AEDECOD” values here are values where ‘AEBODSYS’ are “CARDIAC DISORDERS”.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adae</span>, <span class="no">TRTA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_count</a></span>(<span class="fu">vars</span>(<span class="no">AEBODSYS</span>, <span class="no">AEDECOD</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">ord_layer_1</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
</div>
<div id="shifted-count-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#shifted-count-tables" class="anchor"></a>Shifted Count Tables</h2>
<p>Several tables include performing frequencies based on a shift of a baseline reference value. This is very common in laboratory tests where baseline references are compared with future references. These tables are a special case of count layers, but a method is provided that is intuitive and more efficient.</p>
<p>Constructing a shift layer is similar to constructing a count layer, however the reference values are passed using <code><a href="https://dplyr.tidyverse.org/reference/vars.html">dplyr::vars()</a></code> and named as ‘row’ and ‘column.’</p>
<p>This example uses a randomly sampled adlb dataset which causes the table to appear sparse but the structure is demonstrated. The <code>LBNRIND</code> and <code>BNRIND</code> are updated to a factor to ensure they appear in the table output. If this wasn’t done only ‘NORMAL’ and ‘N’ would appear in the dataset.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">adlb</span>$<span class="no">LBNRIND</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">adlb</span>$<span class="no">LBNRIND</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NORMAL"</span>, <span class="st">"HIGH"</span>))
<span class="no">adlb</span>$<span class="no">BNRIND</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">adlb</span>$<span class="no">BNRIND</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"N"</span>, <span class="st">"H"</span>))
<span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>, <span class="kw">where</span> <span class="kw">=</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">LBNRIND</span>) <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">==</span> <span class="st">"WEEK 4"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_shift</a></span>(<span class="fu">vars</span>(<span class="kw">row</span> <span class="kw">=</span> <span class="no">BNRIND</span>, <span class="kw">column</span> <span class="kw">=</span> <span class="no">LBNRIND</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu">vars</span>(<span class="no">PARAM</span>, <span class="no">VISIT</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
row_label1
</th>
<th style="text-align:left;">
row_label2
</th>
<th style="text-align:left;">
row_label3
</th>
<th style="text-align:left;">
var1_Placebo_NORMAL
</th>
<th style="text-align:left;">
var1_Placebo_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_HIGH
</th>
<th style="text-align:right;">
ord_layer_index
</th>
<th style="text-align:right;">
ord_layer_1
</th>
<th style="text-align:right;">
ord_layer_2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>A major part of the shift API is the control of the denominators used in the calculation of the percentages. In count layers most(but not all) tables have their percentages relative to the columns, each column sums to 100%. In shift layers, most percentages are relative to the “box” that is formed from the baseline and reference group for each treatment group. To support this, Tplyr allows you to pass the variables that the percentage denominators should be in reference too.</p>
<p>The <code><a href="../reference/set_denoms_by.html">set_denoms_by()</a></code> functions can be passed unquoted variables names that were used in the table/layer construction. This will change the denominator of the percentages for the table.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>({
  <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>, <span class="kw">where</span> <span class="kw">=</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">LBNRIND</span>) <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">==</span> <span class="st">"WEEK 4"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_shift</a></span>(<span class="fu">vars</span>(<span class="kw">row</span> <span class="kw">=</span> <span class="no">BNRIND</span>, <span class="kw">column</span> <span class="kw">=</span> <span class="no">LBNRIND</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu">vars</span>(<span class="no">PARAM</span>, <span class="no">VISIT</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx (xx.xx%)"</span>, <span class="no">n</span>, <span class="no">pct</span>)) <span class="kw">%&gt;%</span>
      <span class="co"># This is what it normally defaults to, the 3x3 box formed by the target variables</span>
      <span class="fu"><a href="../reference/set_denoms_by.html">set_denoms_by</a></span>(<span class="no">TRTA</span>, <span class="no">PARAM</span>, <span class="no">VISIT</span>)

  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()
})</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
row_label1
</th>
<th style="text-align:left;">
row_label2
</th>
<th style="text-align:left;">
row_label3
</th>
<th style="text-align:left;">
var1_Placebo_NORMAL
</th>
<th style="text-align:left;">
var1_Placebo_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_HIGH
</th>
<th style="text-align:right;">
ord_layer_index
</th>
<th style="text-align:right;">
ord_layer_1
</th>
<th style="text-align:right;">
ord_layer_2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
1 (100.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
1 (100.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
1 (100.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
1 (100.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>In the example above, the denominators were based on the by and treatment variables, <code>TRTA</code>, <code>PARAM</code> and <code>VISIT</code>. In this example, the denominators are based on the 3 x 3 “box” formed by the baseline and reference variables.</p>
<p>Below, the denominators are changed to be based on the column instead of the 3 x 3 box. By passing the column variables, <code>TRTA</code> and <code>LBNRIND</code> the layer will use those denominator when determining the percentages.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>({
  <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>, <span class="kw">where</span> <span class="kw">=</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">LBNRIND</span>) <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">==</span> <span class="st">"WEEK 4"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_shift</a></span>(<span class="fu">vars</span>(<span class="kw">row</span> <span class="kw">=</span> <span class="no">BNRIND</span>, <span class="kw">column</span> <span class="kw">=</span> <span class="no">LBNRIND</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu">vars</span>(<span class="no">PARAM</span>, <span class="no">VISIT</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx (xx.xx%)"</span>, <span class="no">n</span>, <span class="no">pct</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_denoms_by.html">set_denoms_by</a></span>(<span class="no">TRTA</span>, <span class="no">LBNRIND</span>) <span class="co"># Use the column total as the denominator</span>
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()
})</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
row_label1
</th>
<th style="text-align:left;">
row_label2
</th>
<th style="text-align:left;">
row_label3
</th>
<th style="text-align:left;">
var1_Placebo_NORMAL
</th>
<th style="text-align:left;">
var1_Placebo_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_HIGH
</th>
<th style="text-align:right;">
ord_layer_index
</th>
<th style="text-align:right;">
ord_layer_1
</th>
<th style="text-align:right;">
ord_layer_2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
1 (25.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
1 (11.11%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
1 (16.67%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
1 (11.11%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>In this example, the percentage denominators are calculated row-wise, each row percentage sums to 100%.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>({
  <span class="fu"><a href="../reference/tplyr_table.html">tplyr_table</a></span>(<span class="no">adlb</span>, <span class="no">TRTA</span>, <span class="kw">where</span> <span class="kw">=</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">LBNRIND</span>) <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">==</span> <span class="st">"WEEK 4"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/layer_attachment.html">add_layer</a></span>(
    <span class="fu"><a href="../reference/layer_constructors.html">group_shift</a></span>(<span class="fu">vars</span>(<span class="kw">row</span> <span class="kw">=</span> <span class="no">BNRIND</span>, <span class="kw">column</span> <span class="kw">=</span> <span class="no">LBNRIND</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu">vars</span>(<span class="no">PARAM</span>, <span class="no">VISIT</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_format_strings.html">set_format_strings</a></span>(<span class="fu"><a href="../reference/f_str.html">f_str</a></span>(<span class="st">"xx (xx.xx%)"</span>, <span class="no">n</span>, <span class="no">pct</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/set_denoms_by.html">set_denoms_by</a></span>(<span class="no">BNRIND</span>, <span class="no">PARAM</span>, <span class="no">VISIT</span>) <span class="co"># Each row made by LBNRIND, TRTA</span>
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/build.html">build</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">kable</span>()
})</pre></body></html></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
row_label1
</th>
<th style="text-align:left;">
row_label2
</th>
<th style="text-align:left;">
row_label3
</th>
<th style="text-align:left;">
var1_Placebo_NORMAL
</th>
<th style="text-align:left;">
var1_Placebo_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline High Dose_HIGH
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_NORMAL
</th>
<th style="text-align:left;">
var1_Xanomeline Low Dose_HIGH
</th>
<th style="text-align:right;">
ord_layer_index
</th>
<th style="text-align:right;">
ord_layer_1
</th>
<th style="text-align:right;">
ord_layer_2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Alkaline Phosphatase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspartate Aminotransferase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bilirubin (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Calcium (mmol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Creatine Kinase (U/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Creatinine (umol/L)
</td>
<td style="text-align:left;">
WEEK 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:left;">
0 ( 0.00%)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>These are a few examples however you can pass any combination of variables used in the table or layer so any one of the 32 combinations of the five variables used in the example above could be used to calculate the denominators.</p>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p><a href="http://www.phusewiki.org/wiki/images/b/bf/Cs-whitepaper-adverseevents-v10-4442.pdf">Analysis and Displays Associated with Adverse Events</a></p>
<p><a href="https://www.phuse.eu/documents//working-groups/deliverables/analyses-displays-associated-with-demographics-disposition-medications-in-phase-2-4-clinical-trials-version-20-02-mar-18-11808.pdf">Analyses and Displays Associated with Demographics, Disposition, and Medications</a></p>
<p><a href="http://www.phusewiki.org/wiki/images/4/48/CSS_WhitePaper_CentralTendency_v1.0.pdf">Analyses and Displays Associated with Measures of Central Tendency</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eli Miller, Mike Stackhouse, Ashley Tarasiewicz, Nathan Kosiba.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
